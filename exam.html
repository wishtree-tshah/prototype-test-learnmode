<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AceMedC Exam System</title>
    <style>
        :root {
            --brand-green: #0b3d2e;
            --brand-accent: #2c6e49;
            --text-dark: #222;
            --text-light: #666;
            --error-red: #c62828;
            --warning-orange: #f57c00;
            --info-blue: #1976d2;
            --bg-light: #f9f9f9;
            --bg-answered: #e8f5e9; /* Light green */
            --border-answered: #a5d6a7;
            --bg-bookmarked: #fff3e0; /* Light orange */
            --border-bookmarked: #ffcc80;
            --bg-correct: #e8f5e9;
            --bg-incorrect: #ffebee;
            --bg-revealed: #e3f2fd;
            --radius: 6px;
        }

        body {
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .hidden { display: none !important; }

        /* --- Main Containers --- */
        .exam-container, .start-container, .results-container, .mode-selection-container {
            width: 100%;
            max-width: 900px;
            background: #fff;
            border-radius: var(--radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .start-container, .results-container, .mode-selection-container {
            padding: 3rem;
            text-align: center;
        }

        /* --- Header --- */
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--brand-green);
            color: #fff;
        }
        .question-counter { font-size: 1.1rem; font-weight: 500; }
        .timer { font-size: 1.5rem; font-weight: bold; }
        .timer.time-ok { color: #fff; }
        .timer.time-warn { color: var(--warning-orange); }
        .timer.time-danger { color: var(--error-red); animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* --- Question Area --- */
        .question-body { padding: 2rem 1.5rem; }
        .question-title { font-size: 1.2rem; margin-top: 0; }
        .options-list { list-style: none; padding: 0; margin: 1.5rem 0; }
        .options-list li {
            margin-bottom: 1rem;
        }
        .options-list label {
            display: block;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: var(--radius);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .options-list label:hover { background-color: #f0f0f0; }
        .options-list input[type="radio"]:checked + label,
        .options-list.test-mode-answered input[type="radio"]:checked + label {
            background-color: var(--bg-answered);
            border-color: var(--brand-accent);
            font-weight: 500;
        }
        .options-list input[type="radio"] { display: none; }

        /* Learning Mode Feedback */
        .feedback-box {
            margin-top: 1.5rem; padding: 1rem; border-radius: var(--radius);
            text-align: left; border: 1px solid;
        }
        .feedback-box.correct { background-color: var(--bg-correct); border-color: var(--brand-accent); }
        .feedback-box.incorrect { background-color: var(--bg-incorrect); border-color: var(--error-red); }
        .feedback-box.revealed { background-color: var(--bg-revealed); border-color: var(--info-blue); }
        .feedback-box h4 { margin-top: 0; }
        .options-list.answered .correct-answer { background-color: var(--bg-correct); border-color: var(--brand-accent); }
        .options-list.answered .incorrect-answer { background-color: var(--bg-incorrect); border-color: var(--error-red); }

        /* --- Footer & Navigation --- */
        .exam-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
        }

        .btn {
            display: inline-block;
            background: var(--brand-green);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .btn:hover { background: var(--brand-accent); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        .btn-secondary {
            background: #fff;
            color: var(--brand-green);
            border: 1px solid var(--brand-green);
        }
        .btn-secondary:hover { background: #f0f0f0; }
        .btn-danger { background: var(--error-red); }
        .btn-danger:hover { background: #d32f2f; }

        .bookmark-btn {
            background: none;
            border: 1px solid var(--text-light);
            color: var(--text-light);
            padding: 0.5rem 1rem;
        }
        .bookmark-btn.bookmarked {
            background: var(--bg-bookmarked);
            border-color: var(--warning-orange);
            color: var(--warning-orange);
            font-weight: bold;
        }

        /* --- Modal / Popup --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .modal-content h3 { margin-top: 0; }
        .modal-actions { margin-top: 1.5rem; }
        .modal-actions .btn { margin: 0 0.5rem; }

        /* --- Question Navigator --- */
        .navigator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .nav-item {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 500;
            position: relative;
        }
        .nav-item:hover { background: #f0f0f0; }
        .nav-item.answered { background: var(--bg-answered); border-color: var(--border-answered); }
        .nav-item.current { border-color: var(--brand-accent); border-width: 2px; font-weight: bold; }
        .nav-item.correct { background: var(--bg-correct); border-color: var(--brand-accent); }
        .nav-item.incorrect { background: var(--bg-incorrect); border-color: var(--error-red); }
        .nav-item.revealed { background: var(--bg-revealed); border-color: var(--info-blue); }
        .nav-item .bookmark-icon {
            position: absolute;
            top: 2px; right: 2px;
            font-size: 0.8rem;
            color: var(--warning-orange);
        }

        /* --- Results --- */
        .results-container .score { font-size: 3rem; font-weight: bold; margin: 1rem 0; }
        .results-container .pass { color: var(--brand-accent); }
        .results-container .fail { color: var(--error-red); }

        /* --- Mode Selection --- */
        .mode-selection-container .modes { display: flex; gap: 2rem; margin-top: 2rem; }
        .mode-box { flex: 1; padding: 2rem; border: 2px solid #ccc; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; }
        .mode-box:hover { border-color: var(--brand-accent); background: #f9f9f9; }
        .mode-box h2 { margin-top: 0; }
        .mode-box p { color: var(--text-light); }

    </style>
</head>
<body>

    <!-- 1. Mode Selection Screen -->
    <div id="modeSelectionScreen" class="mode-selection-container">
        <h1>Welcome to the AceMedC Exam</h1>
        <p>Please select your desired mode to begin.</p>
        <div class="modes">
            <div class="mode-box" id="selectTestMode">
                <h2>🎯 Test Mode</h2>
                <p>Take the exam under timed conditions. Results shown only at the end.</p>
            </div>
            <div class="mode-box" id="selectLearningMode">
                <h2>📚 Learning Mode</h2>
                <p>Learn at your own pace with instant feedback and explanations.</p>
            </div>
        </div>
    </div>

    <!-- 2. Start Screen (Details) -->
    <div id="startScreen" class="start-container hidden">
        <h1 id="startTitle"></h1>
        <p id="startDetails"></p>
        <p>The timer cannot be paused once started. Click the button below when you are ready to begin.</p>
        <button id="startExamBtn" class="btn">Start Exam</button>
    </div>

    <!-- 2. Exam Interface (Initially Hidden) -->
    <div id="examScreen" class="exam-container hidden">
        <div class="exam-header">
            <div id="questionCounter" class="question-counter">Question 1 of 5</div>
            <div id="timer" class="timer">--:--</div>
            <button id="reviewBtn" class="btn btn-secondary">Review</button>
        </div>

        <div class="question-body">
            <h2 id="questionTitle" class="question-title"></h2>
            <ul id="optionsList" class="options-list">
                <!-- Options will be dynamically inserted here -->
            </ul>
            <div id="feedbackBox" class="feedback-box hidden"></div>
        </div>

        <div class="exam-footer">
            <div>
                <button id="prevBtn" class="btn btn-secondary">Previous</button>
                <button id="nextBtn" class="btn">Next</button>
            </div>
            <div>
                <button id="bookmarkBtn" class="bookmark-btn">🔖 Bookmark</button>
                <button id="showAnswerBtn" class="btn btn-secondary hidden">Show Answer</button>
                <button id="submitBtn" class="btn btn-danger">Submit</button>
            </div>
        </div>
    </div>

    <!-- 3. Results Screen (Initially Hidden) -->
    <div id="resultsScreen" class="results-container hidden">
        <h1 id="resultTitle"></h1>
        <p>Your Score:</p>
        <div id="resultScore" class="score"></div>
        <div id="resultDetails"></div>
        <button onclick="window.location.reload()" class="btn">Try Again</button>
    </div>

    <!-- 4. Modals (Initially Hidden) -->
    <div id="confirmationModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <p id="modalText"></p>
            <div id="modalActions" class="modal-actions">
                <!-- Buttons will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <div id="navigatorModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>Question Overview</h3>
            <p>Click a number to jump to that question. 🔖 indicates a bookmarked question.</p>
            <div id="navigatorGrid" class="navigator-grid"></div>
            <div class="modal-actions">
                <button id="closeNavBtn" class="btn">Close</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements --- //
    const modeSelectionScreen = document.getElementById('modeSelectionScreen');
    const startScreen = document.getElementById('startScreen');
    const examScreen = document.getElementById('examScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const selectTestModeBtn = document.getElementById('selectTestMode');
    const selectLearningModeBtn = document.getElementById('selectLearningMode');
    const startBtn = document.getElementById('startExamBtn');
    const startTitleEl = document.getElementById('startTitle');
    const startDetailsEl = document.getElementById('startDetails');
    const timerEl = document.getElementById('timer');
    const questionCounterEl = document.getElementById('questionCounter');
    const questionTitleEl = document.getElementById('questionTitle');
    const optionsListEl = document.getElementById('optionsList');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const bookmarkBtn = document.getElementById('bookmarkBtn');
    const showAnswerBtn = document.getElementById('showAnswerBtn');
    const submitBtn = document.getElementById('submitBtn');
    const reviewBtn = document.getElementById('reviewBtn');
    const feedbackBox = document.getElementById('feedbackBox');

    // --- Exam Data & State --- //
    const EXAM_DURATION_SECONDS = 120; // 2 minutes for demo
    const PASSING_SCORE_PERCENT = 80;
    const questions = [
        { text: "Which of the following is the primary pacemaker of the heart?", options: ["Atrioventricular (AV) node", "Purkinje fibers", "Sinoatrial (SA) node", "Bundle of His"], answer: 2, explanation: "The Sinoatrial (SA) node, located in the right atrium, is the heart's natural pacemaker. It initiates the electrical impulses that cause the heart to beat." },
        { text: "A patient presents with symptoms of polyuria, polydipsia, and unexplained weight loss. Which condition is most likely?", options: ["Hypertension", "Hypothyroidism", "Diabetes Mellitus", "Anemia"], answer: 2, explanation: "The classic triad of polyuria (excessive urination), polydipsia (excessive thirst), and polyphagia (or weight loss) are hallmark symptoms of Diabetes Mellitus." },
        { text: "What is the primary function of platelets (thrombocytes) in the blood?", options: ["Carrying oxygen", "Fighting infection", "Blood clotting", "Transporting nutrients"], answer: 2, explanation: "Platelets are small, colorless cell fragments in our blood that form clots and stop or prevent bleeding." },
        { text: "The mitral valve is located between which two chambers of the heart?", options: ["Right atrium and right ventricle", "Left atrium and left ventricle", "Right ventricle and pulmonary artery", "Left ventricle and aorta"], answer: 1, explanation: "The mitral valve, also known as the bicuspid valve, controls blood flow from the left atrium to the left ventricle." },
        { text: "Which of these is a common symptom of iron-deficiency anemia?", options: ["Jaundice", "High fever", "Fatigue", "Joint pain"], answer: 2, explanation: "Fatigue is a very common symptom of iron-deficiency anemia because the body lacks enough iron to produce hemoglobin, which carries oxygen to the body's tissues." }
    ];

    let examState = {
        mode: null, // 'test' or 'learning'
        answers: Array(questions.length).fill(null), // For test: selected index. For learning: { selection: index, status: 'correct'/'incorrect'/'revealed' }
        currentQuestionIndex: 0,
        timerInterval: null,
        timeLeft: EXAM_DURATION_SECONDS,
    };
    let bookmarks = Array(questions.length).fill(false);

    // --- Functions --- //

    const setupMode = (mode) => {
        examState.mode = mode;
        modeSelectionScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');

        if (mode === 'test') {
            startTitleEl.textContent = '🎯 Test Mode';
            startDetailsEl.innerHTML = `
                Total Questions: ${questions.length}<br>
                Time Limit: ${Math.floor(EXAM_DURATION_SECONDS / 60)} minutes<br>
                Passing Score: ${PASSING_SCORE_PERCENT}%
            `;
            submitBtn.textContent = 'Submit Exam';
        } else { // learning mode
            startTitleEl.textContent = '📚 Learning Mode';
            startDetailsEl.innerHTML = `
                Total Questions: ${questions.length}<br>
                Mode: Instant feedback, no time limit.
            `;
            showAnswerBtn.classList.remove('hidden');
            submitBtn.textContent = 'Finish';
        }
    };

    const startExam = () => {
        startScreen.classList.add('hidden');
        examScreen.classList.remove('hidden');
        loadQuestion(examState.currentQuestionIndex);
        startTimer();
        // Prevent browser back button during exam
        history.pushState(null, '', location.href);
        window.onpopstate = () => {
            history.go(1);
            showModal("Navigation Disabled", "Browser navigation is disabled during the exam.", [{ text: "OK", action: closeModal }]);
        };
    };

    const startTimer = () => {
        if (examState.mode === 'test') {
            examState.timeLeft = EXAM_DURATION_SECONDS;
            examState.timerInterval = setInterval(() => {
                examState.timeLeft--;
                updateTimerDisplay(examState.timeLeft);
                if (examState.timeLeft <= 0) {
                    clearInterval(examState.timerInterval);
                    submitExam(true); // Auto-submit
                }
            }, 1000);
        } else { // learning mode
            let timeElapsed = 0;
            examState.timerInterval = setInterval(() => {
                timeElapsed++;
                updateTimerDisplay(timeElapsed, false);
            }, 1000);
        }
    };

    const updateTimerDisplay = (timeInSeconds, isCountdown = true) => {
        const minutes = Math.floor(timeInSeconds / 60);
        const seconds = timeInSeconds % 60;
        timerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

        if (isCountdown) {
            timerEl.className = 'timer'; // Reset
            if (timeInSeconds <= 300) timerEl.classList.add('time-danger');
            else if (timeInSeconds <= 600) timerEl.classList.add('time-warn');
            else timerEl.classList.add('time-ok');

            // Warnings
            if ([600, 300, 60].includes(timeInSeconds)) {
                showModal("Time Warning", `You have ${minutes} minute${minutes > 1 ? 's' : ''} left.`, [{ text: "OK", action: closeModal }]);
            }
        }
    };

    const loadQuestion = (index) => {
        examState.currentQuestionIndex = index;
        const question = questions[index];
        questionCounterEl.textContent = `Question ${index + 1} of ${questions.length}`;
        questionTitleEl.textContent = question.text;
        optionsListEl.innerHTML = '';
        optionsListEl.className = 'options-list'; // Reset classes
        feedbackBox.classList.add('hidden');

        question.options.forEach((option, i) => {
            const li = document.createElement('li');
            const inputId = `q${index}_option${i}`;
            let isChecked = false;
            if (examState.mode === 'test') {
                isChecked = examState.answers[index] === i;
            } else if (examState.answers[index]) {
                isChecked = examState.answers[index].selection === i;
            }

            li.innerHTML = `
                <input type="radio" id="${inputId}" name="question${index}" value="${i}" ${isChecked ? 'checked' : ''}>
                <label for="${inputId}">${option}</label>
            `;
            optionsListEl.appendChild(li);
        });

        if (examState.mode === 'learning') {
            const answerState = examState.answers[index];
            if (answerState) {
                showFeedback(index, answerState.selection);
            }
        }

        updateNavButtons();
        updateBookmarkButton();
    };

    const updateNavButtons = () => {
        prevBtn.disabled = examState.currentQuestionIndex === 0;
        nextBtn.disabled = examState.currentQuestionIndex === questions.length - 1;
    };

    const updateBookmarkButton = () => {
        if (bookmarks[examState.currentQuestionIndex]) {
            bookmarkBtn.classList.add('bookmarked');
            bookmarkBtn.innerHTML = '🔖 Bookmarked';
        } else {
            bookmarkBtn.classList.remove('bookmarked');
            bookmarkBtn.innerHTML = '🔖 Bookmark';
        }
    };

    const showFeedback = (questionIndex, selection) => {
        const question = questions[questionIndex];
        const answerState = examState.answers[questionIndex];
        const isCorrect = selection === question.answer;

        optionsListEl.classList.add('answered');
        optionsListEl.querySelectorAll('input').forEach(input => input.disabled = true);
        showAnswerBtn.classList.add('hidden');

        // Highlight options
        optionsListEl.querySelectorAll('label').forEach((label, i) => {
            if (i === question.answer) {
                label.classList.add('correct-answer');
            } else if (i === selection && !isCorrect) {
                label.classList.add('incorrect-answer');
            }
        });

        // Show feedback box
        let feedbackHTML = '';
        if (answerState.status === 'revealed') {
            feedbackBox.className = 'feedback-box revealed';
            feedbackHTML = `<h4>💡 Answer Revealed</h4>`;
        } else if (isCorrect) {
            feedbackBox.className = 'feedback-box correct';
            feedbackHTML = `<h4>✔️ Correct!</h4>`;
        } else {
            feedbackBox.className = 'feedback-box incorrect';
            feedbackHTML = `<h4>❌ Incorrect</h4><p><strong>Correct Answer:</strong> ${question.options[question.answer]}</p>`;
        }
        feedbackHTML += `<p><strong>Explanation:</strong> ${question.explanation}</p>`;
        feedbackBox.innerHTML = feedbackHTML;
        feedbackBox.classList.remove('hidden');
    };

    const calculateScore = () => {
        let correctCount = 0;
        if (examState.mode === 'test') {
            examState.answers.forEach((answer, index) => {
                if (answer !== null && answer === questions[index].answer) {
                    correctCount++;
                }
            });
            return (correctCount / questions.length) * 100;
        } else { // Learning mode
            const attempted = examState.answers.filter(a => a && a.status !== 'revealed');
            const correct = attempted.filter(a => a.status === 'correct');
            return {
                correct: correct.length,
                incorrect: attempted.length - correct.length,
                revealed: examState.answers.filter(a => a && a.status === 'revealed').length,
                unattempted: examState.answers.filter(a => a === null).length,
                score: attempted.length > 0 ? (correct.length / attempted.length) * 100 : 0
            }
        }
    };

    const submitExam = (isAutoSubmit = false) => {
        clearInterval(examState.timerInterval);
        window.onpopstate = null; // Re-enable back button
        examScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        if (examState.mode === 'test') {
            const score = calculateScore();
            const passed = score >= PASSING_SCORE_PERCENT;
            const answeredCount = examState.answers.filter(a => a !== null).length;

            document.getElementById('resultTitle').textContent = isAutoSubmit ? "Time's Up!" : "Exam Submitted";
            document.getElementById('resultScore').textContent = `${score.toFixed(0)}%`;
            document.getElementById('resultScore').classList.add(passed ? 'pass' : 'fail');
            document.getElementById('resultDetails').innerHTML = `
                <p>You ${passed ? '<strong>PASSED</strong>' : '<strong>FAILED</strong>'}.</p>
                <p>Passing Score: ${PASSING_SCORE_PERCENT}%</p>
                <p>${answeredCount} / ${questions.length} questions answered.</p>
            `;
        } else { // Learning mode
            const results = calculateScore();
            document.getElementById('resultTitle').textContent = "Learning Summary";
            document.getElementById('resultScore').textContent = `${results.score.toFixed(0)}%`;
            document.getElementById('resultDetails').innerHTML = `
                <p><strong>Performance Breakdown:</strong></p>
                <p style="color: var(--brand-accent)">✔️ Correct: ${results.correct}</p>
                <p style="color: var(--error-red)">❌ Incorrect: ${results.incorrect}</p>
                <p style="color: var(--info-blue)">💡 Revealed: ${results.revealed}</p>
                <p>⚪ Unattempted: ${results.unattempted}</p>
                <p><em>Score is calculated based on attempted questions only.</em></p>
            `;
        }
    };

    // --- Modal Handling ---
    const modal = document.getElementById('confirmationModal');
    const showModal = (title, text, actions) => {
        if (modal.classList.contains('hidden') === false) return; // Don't stack modals
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalText').textContent = text;
        const actionsContainer = document.getElementById('modalActions');
        actionsContainer.innerHTML = '';
        actions.forEach(actionInfo => {
            const btn = document.createElement('button');
            btn.textContent = actionInfo.text;
            btn.className = `btn ${actionInfo.class || 'btn-secondary'}`;
            btn.onclick = actionInfo.action;
            actionsContainer.appendChild(btn);
        });
        modal.classList.remove('hidden');
    };
    const closeModal = () => modal.classList.add('hidden');

    // --- Navigator Modal ---
    const navModal = document.getElementById('navigatorModal');
    const openNavigator = () => {
        const grid = document.getElementById('navigatorGrid');
        grid.innerHTML = '';
        questions.forEach((_, i) => {
            const item = document.createElement('div');
            item.className = 'nav-item';
            item.textContent = i + 1;
            if (examState.mode === 'test') {
                if (examState.answers[i] !== null) item.classList.add('answered');
            } else { // learning mode
                const answerState = examState.answers[i];
                if (answerState) {
                    if (answerState.status === 'correct') item.classList.add('correct');
                    else if (answerState.status === 'incorrect') item.classList.add('incorrect');
                    else if (answerState.status === 'revealed') item.classList.add('revealed');
                }
            }

            if (i === examState.currentQuestionIndex) item.classList.add('current');
            if (bookmarks[i]) {
                item.innerHTML += '<span class="bookmark-icon">🔖</span>';
            }

            item.onclick = () => {
                loadQuestion(i);
                navModal.classList.add('hidden');
            };
            grid.appendChild(item);
        });
        navModal.classList.remove('hidden');
    };

    // --- Event Listeners --- //
    selectTestModeBtn.addEventListener('click', () => setupMode('test'));
    selectLearningModeBtn.addEventListener('click', () => setupMode('learning'));

    startBtn.addEventListener('click', () => {
        const message = examState.mode === 'test' ? "The timer will start immediately and cannot be paused." : "Ready to start learning?";
        showModal(
            "Are you ready to begin?",
            message,
            [
                { text: "Cancel", action: closeModal },
                { text: "Yes, Start", class: "btn", action: () => { closeModal(); startExam(); } }
            ]
        );
    });

    nextBtn.addEventListener('click', () => {
        if (examState.currentQuestionIndex < questions.length - 1) {
            loadQuestion(examState.currentQuestionIndex + 1);
        }
    });

    prevBtn.addEventListener('click', () => {
        if (examState.currentQuestionIndex > 0) {
            loadQuestion(examState.currentQuestionIndex - 1);
        }
    });

    optionsListEl.addEventListener('change', (e) => {
        if (e.target.type === 'radio') {
            const selection = parseInt(e.target.value);
            if (examState.mode === 'test') {
                examState.answers[examState.currentQuestionIndex] = selection;
            } else { // learning mode
                const isCorrect = selection === questions[examState.currentQuestionIndex].answer;
                examState.answers[examState.currentQuestionIndex] = { selection, status: isCorrect ? 'correct' : 'incorrect' };
                showFeedback(examState.currentQuestionIndex, selection);
            }
        }
    });

    bookmarkBtn.addEventListener('click', () => {
        bookmarks[examState.currentQuestionIndex] = !bookmarks[examState.currentQuestionIndex];
        updateBookmarkButton();
    });

    showAnswerBtn.addEventListener('click', () => {
        examState.answers[examState.currentQuestionIndex] = { selection: null, status: 'revealed' };
        showFeedback(examState.currentQuestionIndex, null);
    });

    submitBtn.addEventListener('click', () => {
        let answeredCount = 0;
        if (examState.mode === 'test') {
            answeredCount = examState.answers.filter(a => a !== null).length;
        } else {
            answeredCount = examState.answers.filter(a => a !== null).length;
        }
        const bookmarkedCount = bookmarks.filter(b => b).length;
        const unanwseredCount = questions.length - answeredCount;

        showModal(
            `Submit ${examState.mode === 'test' ? 'Exam' : 'Session'}?`,
            `You have ${unanwseredCount} unanswered questions and ${bookmarkedCount} bookmarked questions. Are you sure you want to finish?`,
            [
                { text: "Go Back and Review", action: closeModal },
                { text: "Submit Final", class: "btn-danger", action: () => { closeModal(); submitExam(); } }
            ]
        );
    });

    reviewBtn.addEventListener('click', openNavigator);
    document.getElementById('closeNavBtn').addEventListener('click', () => navModal.classList.add('hidden'));
});
</script>

</body>
</html>